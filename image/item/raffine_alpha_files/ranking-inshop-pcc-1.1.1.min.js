/*
 ranking-inshop-pcc-1.1.1.js 1.1.1 Copyright (c)
 @year Rakuten.Inc Date :
 @compressesDate
*/
jQuery.noConflict();
(function(e){function u(a){return"jsonp"+a+"111111"+q}function z(a){e("#rnkInShopButtonLeft img").click(function(){if(!l){l=!0;if(v()){h=e("#rnkInShopRankBox").width();if(0!=f)var c=A(f,a);a=Math.floor(h/n);g.items.length<=a&&r()}B(a,c);setTimeout(function(){l=!1},(a-1)*m)}});e("#rnkInShopButtonRight img").click(function(){if(!l){l=!0;if(v()){h=e("#rnkInShopRankBox").width();if(0!=f)var c=C(f,a);a=Math.floor(h/n);g.items.length<=a&&r()}D(a,c);setTimeout(function(){l=!1},(a-1)*m)}})}function v(){var a=
e("#rnkInShopRankBox").width();return h!=a?!0:!1}function C(a,c){c=Math.floor(h/n);var b=Math.floor((a+1)/c);return 0==(a+1)%c?(b+1)*c:(b+2)*c}function A(a,c){var b;c=Math.floor(h/n);var d=Math.floor((a+1)/c);0==(a+1)%c?b=(d-1)*c:(b=d*c,b==a&&(b=(d-1)*c));return b}function B(a,c){f=null==c?f-a:c;0>f&&(f=g.items.length-g.items.length%a,f==g.items.length&&(f=g.items.length-a));for(var b=f,d=0;d<a;d++)w(b,d,d*m),b++}function D(a,c){f=null==c?f+a:c;f>=g.items.length&&(f=0);for(var b=a-1,d=f+b,e=b;0<=
e;e--)w(d,e,(b-e)*m),d--}function w(a,c,b){setTimeout(function(){E(a,c)},b)}function E(a,c){g.items.length>a&&x(g.items[a],c);var b=e("#rnkInShopRank"+c+" .rnkInShopRank"),d=b.eq(0),f=b.eq(1);f.css({position:"absolute",opacity:"0"});""==f.text()&&d.animate({opacity:0},0,"linear");d.animate({opacity:0},m,"linear",function(){d.empty()});f.animate({opacity:1},m,"linear",function(){f.css({position:""});d.remove()})}function r(){e("#rnkInShopButtonLeft img").hide();e("#rnkInShopButtonRight img").hide()}
function x(a,c){var b=e("#rnkInShopTemplate"),d=b.find(" .rnkInShopItemImg img"),f=b.find(" .rnkInShopItemImg a"),g=b.find(" .rnkInShopItemRankValue"),h=b.find(" .rnkInShopItemName a"),l=b.find(" .rnkInShopPriceValue"),m=b.find(" .rnkInShopItemReview a span"),n=b.find(" .rnkInShopItemReview a"),q=b.find(" .rnkInShopItemStar"),r=b.find(" .rnkInShopPostage"),p=b.find(" .rnkInShopItemStarBox"),s=e("#rnkInShopRank"+c);d.attr("src",F(a.image64url));f.attr("href",a.link+"?s-id="+k.attr("sid"));g.text(a.rank);
h.text(a.name.split("").join(String.fromCharCode(8203)));h.attr("href",a.link+"?s-id="+k.attr("sid"));l.text(a.displayprice);0==a.reviewnum?p.hide():(m.text(a.displayreviewnum),n.attr("href",a.reviewurl+"?l-id="+k.attr("sid")),q.html(G(a.displayreviewave)),p.show());r.text(a.displaypostageflg);s.append(b.html())}function F(a,c){return a=a.replace("ex=64x64","ex=95x95")}function G(a){var c="";a=a.split(",");for(var b=0;b<a.length;b++)"11"==a[b]?c+='<div class="rnkInShopStarOn"></div>':"01"==a[b]?c+=
'<div class="rnkInShopStarHalf"></div>':"00"==a[b]&&(c+='<div class="rnkInShopStarOff"></div>');return c}function H(a){if(!Number.isFinite(parseInt(a.attr("du")))||!Number.isFinite(parseInt(a.attr("shopid"))))return!1;try{a.attr("offset",y(a.attr("offset"),I))}catch(c){return!1}try{a.attr("len",y(a.attr("len"),J))}catch(b){return!1}return!0}function y(a,c){var b=a;void 0!==a&&""!==a&&null!==a||(b=c);if(!Number.isFinite(parseInt(b)))throw"error:not number";return b}var K=navigator.userAgent.match(/msie/i),
g,k=e("#rnkInShopConfig"),p,m=100,n="118",s=e("#rnkInShopPartsArea"),I="20",J="34",f=0,h,l=!1,t,q=1;Number.isFinite=Number.isFinite||function(a){return"number"===typeof a&&isFinite(a)};e(function(){if(H(k)){var a={url:"http://shopapi.ranking.rakuten.co.jp/q?qt=14&du="+k.attr("du")+"&offset="+k.attr("offset")+"&eid=12&sid="+k.attr("shopid")+"&len="+k.attr("len")+"&enc=0",cache:!1,dataType:"jsonp",scriptCharset:"euc-jp",timeout:3E3,jsonpCallback:u(k.attr("shopid")),success:function(b){g=b;if(b=g.shopid==
k.attr("shopid"))if(b=0<g.num){b=g.updatedate;var d=null==p?new Date:new Date(p),c=d.getFullYear()+"/"+("0"+(d.getMonth()+1)).slice(-2)+"/"+("0"+d.getDate()).slice(-2);b==c?b=!0:10<=d.getHours()?b=!1:(d.setDate(d.getDate()-1),d=d.getFullYear()+"/"+("0"+(d.getMonth()+1)).slice(-2)+"/"+("0"+d.getDate()).slice(-2),b=b==d)}if(b){s.show();try{scAjaxRequestc18(!0)}catch(l){}h=itemsAreaWidth=e("#rnkInShopRankBox").width();b=Math.floor(itemsAreaWidth/n);d="";for(c=f;c<b;c++)d+="<div class='rnkInShopRankFrame' id='rnkInShopRank"+
c+"'></div>";e("#rnkInShopRankBox").append(d);d=b;t=e("#rnkInShopRankBox .rnkInShopRankFrame");c=100/d;K?t.css("width",99/d+"%"):t.css("width",c+"%");g.items.length<=b&&(b=g.items.length,r());d=g.displaydate.displayupdatedate+"更新 (集計日："+g.displaydate.displayrankingstartdate+"&#65374;"+g.displaydate.displayrankingenddate+")";e("#rnkInShopDuration").append(d);for(d=0;d<b;d++)x(g.items[d],d);z(b)}else if(q++,2>=q)a.jsonpCallback=u(k.attr("shopid")),e.ajax(a);else try{scAjaxRequestc18(!1)}catch(m){}},
error:function(){s.hide();try{scAjaxRequestc18(!1)}catch(a){}},complete:function(){}};e.ajax({url:"http://gettime.r10s.jp/",cache:!1,dataType:"jsonp",scriptCharset:"euc-jp",timeout:3E3,success:function(b){b=b.epoch;void 0!==b&&""!==b&&null!==b&&Number.isFinite(b)&&(p=1E3*parseInt(b));e.ajax(a)},error:function(){e.ajax(a)}})}else{s.remove();try{scAjaxRequestc18(!1)}catch(c){}}})})(jQuery);
