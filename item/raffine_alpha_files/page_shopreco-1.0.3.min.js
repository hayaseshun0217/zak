/*
 page_shopreco.js 1.0.3
 Copyright (c) 2013 Rakuten.Inc
 Date : 2013-04-03 17:42:41
*/
(function(j,h){if(j.jQuery!==h){jQuery.noConflict();var c=jQuery;if(c.RJS_Helpers&&c().PAGE_Slideshow){var e=null,k=function(){var a=this;c.extend(a,{settings:{common:{noready:[1,"Int","^[0-1]$"],pagespeed:[100,"Range","0,9999"],opacityspeed:[100,"Range","0,9999"],omitname:[100,"Range","0,100"],imagesize:["128x128","Str","^[1-9]{1}[0-9]{1,2}x[1-9]{1}[0-9]{1,2}"],autoslidetime:[2,"Range","1,99"],autoslideflag:["next","Str","^(next|prev)$"],autoslide:[0,"Int","^[0-1]$"],autoresize:[1,"Int","^[0-1]$"],
impvar:["","Str","^[a-zA-Z0-9_]{3,64}$"],impdisp:["","Str","^[a-zA-Z0-9_]{3,64}$"],impnodisp:["","Str","^[a-zA-Z0-9_]{3,64}$"],verticalmode:[0,"Int","^[1]$"],ajaxtimer:[3,"Range","1,99"],recothreshold:[5,"Int","^[1-9]$"],rankingshuffle:[1,"Int","^[0-1]$"],requestwait:[500,"Range","1,9999"],checkinterval:[100,"Range","1,9999"],shopid:[0,"Range","1,999999"],itemid:[0,"Range","1,99999999"]},reco:{maxitem:[3,"Int","^[1-9]$"],url:["","Str","^http(s?)+(:\\/\\/[a-zA-Z0-9_\\-\\.]+)(\\.rakuten\\.co\\.jp\\/)+([a-zA-Z0-9_&=\\?\\-\\.\\/]+)$"],
sid:["","Str","^[a-zA-Z0-9_\\-]{3,64}$"]}},eobj:{common:{config:c("#pageRecoCommonConfig"),existItem:c("#rakutenLimitedId_inshop_recommend"),altContents:c("#InshopRecoRecoAlteredContents"),recoSlider:c("#InshopRecoRecoSlider"),loading:c("#InshopRecoLoading")},reco:{config:c("#pageShopRecoConfig"),prevButton:c("#InshopRecoPrevButton"),nextButton:c("#InshopRecoNextButton"),proto:c("#prototypePageRecoItem"),itemsDisplay:c("#InshopRecoRecoItemsDisplay"),altContents:c("#InshopRecoRecoAlteredContents")}},
status:{error:!1,isTimeout:!1},props:{reco:{items:[],proto:{html:"",height:0,width:0,identifiers:{itemurl:["",/\#ITEMURL\#/g,""],imageurl:['<img src="',/\#ITEMIMGELE\#/g,'" >'],itemname:["",/\#ITEMNAME\#/g,""],itemprice:["",/\#ITEMPRICE\#/g,""],itemdelivery:["",/\#ITEMDELIVERY#/g,""],reviewcnt:["",/\#REVIEWCNT#/g,""],reviewave:["",/\#REVIEWAVE#/g,""]}}},currentAshiatoIndex:!1,requestPermission:!0,requestPermissionTimer:null,checkWaitInterval:null,initialized:!1},initialize:function(){if(!0!=a.props.initialized)a.loadSettings()?
1==a.settings.noReady?a.begin():c(document).ready(function(){a.begin()}):a.displayDefaultContents(),a.props.initialized=!0},loadSettings:function(){a.eobj.reco.proto.hide();a.settings.common=c.RJS_Helpers.readAttr(a.eobj.common.config,a.settings.common);a.settings.reco=c.RJS_Helpers.readAttr(a.eobj.reco.config,a.settings.reco);c.extend(a.settings.reco,a.settings.common,a.settings.reco);a.settings.reco.autoslide=0;if(""==a.settings.reco.url||512<a.settings.reco.url.length||0===a.eobj.reco.proto.length)return!1;
a.settings.common.autoslidetime*=1E3;a.settings.common.ajaxtimer*=1E3;a.eobj.common.config.remove();a.eobj.reco.config.remove();return!0},displayDefaultContents:function(d){a.eobj.reco.proto.remove();a.eobj.common.recoSlider.remove();a.eobj.common.loading.remove();a.eobj.common.existItem.remove();d&&a.regImpressionCode(d)},displayRecoDefaultContents:function(){a.eobj.common.loading.hide();a.eobj.common.recoSlider.hide();a.eobj.reco.altContents.show()},displayRecoLoading:function(){a.eobj.reco.altContents.hide();
a.eobj.common.altContents.hide();a.eobj.common.recoSlider.hide()},begin:function(){a.getShopRecoData()},getShopRecoData:function(){a.displayRecoLoading();if(a.props.requestPermission){var d;a.status.isTimeout=!1;try{d=setTimeout(function(){a.status.isTimeout=!0;a.displayDefaultContents()},a.settings.common.ajaxtimer),c.ajax({url:a.settings.reco.url,cache:!1,dataType:"jsonp",data:{shop_id:a.settings.common.shopid,item_ids:a.settings.common.itemid},scriptCharset:"euc-jp",timeout:a.settings.common.ajaxtimer,
success:function(b){if(a.status.isTimeout)b=!1;else if(clearTimeout(d),b.code===h||b.num===h||0!=b.code)b=!1;else{var c=[],e=b.items.length;if(e>a.settings.common.maxcount)e=a.settings.common.maxcount;for(var f=0;f<e;f++){var g={};g.itemname=a.editItemname(b.items[f].itemname);g.itemurl=a.editItemurl(b.items[f].itemurlfull,a.settings.reco.sid);g.imageurl=a.editImageurl(b.items[f].imageurl128);g.itemprice=a.editPrice(b.items[f].itemprice);g.itemdelivery=a.editPostage(b.items[f].postageflg);if(3<b.items[f].reviewnum)g.reviewcnt=
a.editReviewCnt(b.items[f].reviewnum,b.items[f].reviewurl),g.reviewave=a.editReviewAve(b.items[f].reviewave);c.push(g)}a.props.reco.items=c;b=b.num<a.settings.common.recothreshold?!1:a.displayRecoData()}b||(clearTimeout(d),a.displayDefaultContents())},error:function(){a.displayDefaultContents()}})}catch(b){return clearTimeout(d),a.displayDefaultContents(),!1}return!0}clearInterval(a.props.checkWaitInterval);a.props.checkWaitInterval=setInterval(function(){a.props.requestPermission&&(clearInterval(a.props.checkWaitInterval),
a.getShopRecoData())},a.settings.common.checkinterval)},displayRecoData:function(){a.eobj.common.recoSlider.show();if(0===a.eobj.reco.proto.length)return!1;a.props.reco.proto.width=a.eobj.reco.proto.outerWidth();a.props.reco.proto.height=a.eobj.reco.proto.outerHeight();a.props.reco.proto.html=a.eobj.reco.proto.html();if(""==a.props.reco.proto.html)return!1;a.eobj.reco.proto.hide();a.eobj.reco.itemsDisplay.empty();a.eobj.reco.prevButton.find("a").unbind("click");a.eobj.reco.nextButton.find("a").unbind("click");
a.eobj.common.existItem.show();a.eobj.reco.altContents.hide();a.eobj.common.loading.hide();a.regImpressionCode(a.settings.common.impdisp);a.eobj.reco.itemsDisplay.PAGE_Slideshow(a,{settings:a.settings.reco,itemPrototype:a.props.reco.proto,eobj:a.eobj.reco,items:a.props.reco.items,events:{beforeFirstRender:function(a,b){b.props.initialized=!0;b.eobj.reco.itemsDisplay.show()},afterFirstRender:function(a,b){b.eobj.reco.itemsDisplay.find("div div").css("filter","alpha(opacity=100)");b.props.requestPermission=
!1;b.props.requestPermissionTimer=setTimeout(function(){b.props.requestPermission=!0},b.settings.common.requestwait)}}});return!0},regImpressionCode:function(d){return j[a.settings.common.impvar]===h||""==d?"":j[a.settings.common.impvar]=d},shuffle:function(a){for(var a=Array.apply(null,a),b=a.length;b;){var c=Math.floor(Math.random()*b),e=a[--b];a[b]=a[c];a[c]=e}return a},endsWith:function(a,b){var c=a.length-b.length;return 0<=c&&a.lastIndexOf(b)===c},editItemname:function(d){d=c.RJS_Helpers.omitStr(d,
a.settings.common.omitname,"…");c.browser.msie||(d=d.split("").join(String.fromCharCode(8203)));return d},editImageurl:function(d){""!=d&&(d=c.RJS_Helpers.urlParameter(d,{_ex:a.settings.common.imagesize}));return d},editItemurl:function(a,b,e){""!=b&&(a=e?c.RJS_Helpers.urlR2Parameter(a,{"s-id":b},!1):c.RJS_Helpers.urlParameter(a,{"s-id":b},!1));return a},editPrice:function(a){var b="",c=0;if("undefined"==typeof a)return"";for(var e=a.length-1;0<=e;e--)b=a.charAt(e)+b,c++,0==c%3&&0!=e&&(b=","+b);return b+
"円"},editPostage:function(a){if(""!=a){if("0"===a)return"送料込";if("1"===a)return"送料別"}return""},editReviewCnt:function(a,b){return'<a href="'+b+'">レビュー('+a+"件)</a>"},editReviewAve:function(a){var b="";for(i=0;5>i;i++)b=1<=a?b+'<div class="reviewstarOn"><br/></div>':0.5<a?b+'<div class="reviewstarHalf"><br/></div>':b+'<div class="reviewstarOff"><br/></div>',a-=1;return b}})};c(document).ready(function(){var a=parseInt(c.browser.version);c.browser.msie&&"BackCompat"===document.compatMode&&9>=a?setTimeout(function(){null==
e&&(e=new k,e.initialize())},3E3):null==e&&(e=new k,e.initialize())})}}})(this);
