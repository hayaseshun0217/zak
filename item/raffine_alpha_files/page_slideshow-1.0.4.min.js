/*
 page_slideshow.js 1.0.4
 Copyright (c) 2013 Rakuten.Inc
 Date : 2013-03-13 13:39:54
*/
(function(q,k){function p(f){eleCSSText=f.css("cssText")+";";zindex=f.css("z-index");opacity=f.css("opacity");width=f.css("width");position=f.css("position");floatprop=f.css("float");filterprop=f.css("filter");return eleCSSText+="z-index:"+zindex+h+"opacity:"+opacity+";width:"+width+h+"position:"+position+h+"float:"+floatprop+h+"filter:"+filterprop+";"}function l(f){cssStr=f.css("cssText");return null==cssStr?"":cssStr+";"}if(q.jQuery!==k){jQuery.noConflict();var f=jQuery;if(f.RJS_Helpers){var h=
"!important; ",t=function(r,s){var a=this;if(!(r===k||s===k))a.mainObj=r,f.extend(this,{settings:{maxitem:5,pagespeed:100,opacityspeed:100,autoslidetime:2,autoslideflag:"",autoslide:0,autoresize:0,verticalmode:0,dispresize:0},eobj:{itemsDisplay:!1,prevButton:!1,nextButton:!1},canvas:{front:!1,back:!1,autoPlayTimer:!1},itemPrototype:{html:"",height:0,width:0},items:!1,itemIndex:[],itemEvents:{remove:!1},status:{animation:!1,preparingItems:!1,renderReset:!1,resizeCurrStart:!1,resizeCurrEnd:!1,callBackResize:!1},
pageConf:{maxAllowed:5,currStart:0,currEnd:0,currCnt:0,width:0},events:{afterSlide:!1,onItemRemove:!1,afterFirstRender:!1,beforeFirstRender:!1,onZeroItems:!1,onResize:!1}},s),f.extend(this,{initialize:function(){var b=0,e,d;if(1>a.items.length||!a.eobj.itemsDisplay||!a.eobj.prevButton||!a.eobj.nextButton)return a;for(e in a.items)a.itemIndex[b]=e,b++;b=a.itemIndex.length;for(d in a.events)!f.isFunction(a.events[d])&&(a.events[d]=!1);if(1===a.settings.autoslide&&!f.isFunction(a[a.settings.autoslideflag]))a.settings.autoslide=
0;a.pageConf.maxAllowed=Math.min(a.settings.maxitem,b);1===a.settings.autoresize&&0===a.settings.verticalmode&&0<a.itemPrototype.width&&(a.resize(!1),f(q).resize(function(){a.resize(!0)}),1===a.settings.dispresize&&f(a.eobj.itemsDisplay).resize(function(){a.resize(!0)}));d=Math.min(a.pageConf.maxAllowed,b);a.prepareItems(0,d).render(0,d,!1).manageControls().prepareItems(d,b);return a},prepareItems:function(b,e){var d=a.itemPrototype.html,c=a.itemPrototype.identifiers,g="",h,j,m;if(a.status.preparingItems)return a;
if(a.status.animation)return setTimeout(function(){a.prepareItems(b,e)},a.settings.pagespeed),a;a.status.preparingItems=!0;for(j=b;j<e;j++){g=d;h=a.items[a.itemIndex[j]];for(m in c)g=g.replace(c[m][1],h[m]!=k?c[m][0]+h[m]+c[m][2]:"");h.ele=f(g)}if(""!=a.itemEvents.remove)for(j=b;j<e;j++)a.items[a.itemIndex[j]].ele.find(a.itemEvents.remove).attr("id","").bind("click",{index:j},function(b){b.preventDefault();a.removeItem(b.data.index);return!1});a.status.preparingItems=!1;return a},render:function(b,
e,d,c){function f(){function d(b,c,e){(b=a.items[a.itemIndex[b]])&&b.ele.animate({opacity:0},a.settings.opacityspeed,"linear");(c=a.items[a.itemIndex[c]])&&c.ele.animate({opacity:1},a.settings.opacityspeed,"linear");e||setTimeout(function(){a.canvas.front[0]!==k&&null!==a.canvas.front[0].parentNode&&a.canvas.front[0].parentNode.removeChild(a.canvas.front[0]);a.canvas.front=a.canvas.back;a.play();a.status.animation=!1;a.status.renderReset=!1;a.status.callBackResize&&a.resize(!0);a.events.afterSlide&&
a.events.afterSlide(a.pageConf.currStart,a.mainObj)},a.settings.opacityspeed)}var j=a.pageConf.maxAllowed,h=1,g=e-b,n,o,l=!0;c?(n=a.pageConf.currCnt!=j?Math.ceil(a.pageConf.currEnd/j)*j-1:a.pageConf.currEnd-1,o=g!=j?Math.ceil(e/j)*j-1:e-1,a.status.renderReset&&(n=-1,g!=j&&(j=g,o=e-1)),h=-1):(n=a.pageConf.currStart,o=b);for(g=0;l;g++,n+=h,o+=h)setTimeout(function(a,b,c){return function(){d(a,b,c)}}(n,o,l=g+1<j),g*a.settings.pagespeed)}if(a.status.animation||a.status.preparingItems)return a;d=typeof d!==
k?!1===d?!1:!0:!0;c=typeof c!==k?!0===c?!0:!1:!1;if(0>b)return a;a.status.animation=!0;a.stop();if(e>a.itemIndex.length&&(e=a.itemIndex.length,e-b>a.pageConf.maxAllowed))return a;!1===d?(a.canvas.front=a.prepareElements(b,e,2,1),a.events.beforeFirstRender&&a.events.beforeFirstRender(a.pageConf.maxAllowed,a.mainObj),a.eobj.itemsDisplay.append(a.canvas.front),a.play(),a.status.animation=!1,a.events.afterFirstRender&&a.events.afterFirstRender(a.pageConf.maxAllowed,a.mainObj)):(a.status.renderReset&&
a.canvas.front[0].parentNode.removeChild(a.canvas.front[0]),a.canvas.back=a.prepareElements(b,e,2,0),a.eobj.itemsDisplay.append(a.canvas.back),f());a.pageConf.currStart=b;a.pageConf.currEnd=e;a.pageConf.currCnt=e-b;a.manageControls();return a},prepareElements:function(b,e,d,c){var g;g=f("<div>").css("cssText","position:absolute!important; width:100%!important; float: none!important;");eleCSSText=" z-index:"+d+h+"opacity:"+c+";position: relative"+h;1==c?eleCSSText+="filter:alpha(opacity=100);":0==
c&&(eleCSSText+="filter:alpha(opacity=0);");for(d=b;d<e;d++)b=a.items[a.itemIndex[d]].ele,g.append(b.css("cssText",l(b)+eleCSSText));a.justifyElements(g);return g},manageControls:function(){0===a.pageConf.currStart&&a.pageConf.currEnd>=a.itemIndex.length?(prevEle=a.eobj.prevButton.find("a"),prevEle.css("cssText",l(prevEle)+"display:none!important;"),nextEle=a.eobj.nextButton.find("a"),nextEle.css("cssText",l(nextEle)+"display:none!important;")):(prevEle=a.eobj.prevButton.find("a"),prevEle.css("cssText",
l(prevEle)+"display:inline!important;"),prevEle.focus(function(){this.blur()}).click(function(b){b.preventDefault();a.prev();return!1}),nextEle=a.eobj.nextButton.find("a"),nextEle.css("cssText",l(nextEle)+"display:inline!important;"),nextEle.focus(function(){this.blur()}).click(function(b){b.preventDefault();a.next();return!1}));return a},prev:function(){if(0===a.pageConf.currStart&&a.pageConf.currEnd===a.itemIndex.length)return a;0===a.pageConf.currStart?a.render(Math.floor((a.itemIndex.length-1)/
a.pageConf.maxAllowed)*a.pageConf.maxAllowed,a.itemIndex.length):a.render(a.pageConf.currStart-a.pageConf.maxAllowed,a.pageConf.currStart);return a},next:function(){if(0===a.pageConf.currStart&&a.pageConf.currEnd===a.itemIndex.length)return a;a.pageConf.currEnd>=a.itemIndex.length?a.render(0,a.pageConf.maxAllowed,!0,!0):a.render(a.pageConf.currEnd,a.pageConf.currEnd+a.pageConf.maxAllowed,!0,!0);return a},removeItem:function(b){var e=a.canvas.front,d,c,g;d=!1;var k;if(a.status.animation||a.status.preparingItems)return!1;
a.items[b].ele.fadeOut(a.settings.opacityspeed,function(){f(this).remove()});a.events.onItemRemove&&a.events.onItemRemove(b,a.mainObj);if(1==a.itemIndex.length)return a.events.onZeroItems&&a.events.onZeroItems(a.mainObj),!1;b=f.inArray(b+"",a.itemIndex);if(-1==b)return!1;a.itemIndex.splice(b,1);a.pageConf.currEnd==a.itemIndex.length+1&&(a.pageConf.currEnd--,a.pageConf.currCnt--);if(b==a.itemIndex.length)0==b%a.pageConf.maxAllowed&&a.prev();else{a.status.animation=!0;for(c=b,g=0;!d;c++,g++){d=a.items[a.itemIndex[c]].ele;
cssStr=p(d);d.css("cssText",cssStr+"z-index:1"+h+"opacity:0;");if(k=c==a.pageConf.currEnd-1)e.append(d),c==b&&(g=1);setTimeout(function(b,c){return function(){b.animate({opacity:"1"},a.settings.opacityspeed,"linear",function(){a.status.animation=c;!a.status.animation&&a.status.callBackResize&&a.resize(!0)})}}(d,!(d=c===a.itemIndex.length-1||k)),g*a.settings.pagespeed)}}a.justifyElements().manageControls();return!1},play:function(){if(0===a.settings.autoslide)return a;a.autoPlayTimer=setTimeout(function(){a[a.settings.autoslideflag]()},
a.settings.autoslidetime);return a},stop:function(){if(0===a.settings.autoslide)return a;clearTimeout(a.autoPlayTimer);a.autoPlayTimer=!1;return a},justifyElements:function(b){var e=a.pageConf.maxAllowed;if(1!==a.settings.autoresize)return a;if(b===k)b=a.canvas.front;b=b.children("*");for(i=0;i<b.length;i++)cssStr=p(f(b[i])),f(b[i]).css("cssText",cssStr+"width:"+(e>=a.settings.maxitem?Math.floor(1E4*(99/e))/1E4+"%":"")+h);return a},resize:function(b){var e=a.pageConf,d,c;if(a.status.animation||a.status.preparingItems)return a.status.callBackResize=
!0,a;d=a.eobj.itemsDisplay.width();c=Math.floor(d/a.itemPrototype.width);if(c<a.settings.maxitem)c=a.settings.maxitem;if(c==e.maxAllowed)return a;d=e.maxAllowed;e.maxAllowed=c;if(!b)return a;a.status.animation=!0;a.stop();a.status.renderReset?(b=a.status.resizeCurrStart,c=a.status.resizeCurrEnd):(b=e.currStart,c=e.currEnd);cntItem=c-b;if(e.maxAllowed>d){if(c!=a.itemIndex.length){frontEle=a.canvas.front;for(d=cntItem;d<e.maxAllowed;d++){c=b+d;if(c>=a.itemIndex.length)break;if(a.itemIndex[c]===k)break;
c=a.items[a.itemIndex[c]].ele;cssStr=p(c);c.css("cssText",cssStr+"z-index:2"+h).animate({opacity:1},0);frontEle.append(c)}c=b+d}}else if(cntItem>e.maxAllowed){for(d=cntItem;d>e.maxAllowed;d--){c=b+d-1;if(a.itemIndex[c]===k)break;c=a.items[a.itemIndex[c]].ele;c[0].parentNode&&c[0].parentNode.removeChild(c[0])}c=b+d}a.status.resizeCurrStart=b;a.status.resizeCurrEnd=c;e.currCnt=c-b;a.status.renderReset=!0;a.justifyElements();d=b%e.maxAllowed;0!=d&&(b+=e.maxAllowed-d);c=b+e.maxAllowed;if(c>a.itemIndex.length)c=
a.itemIndex.length;e.currStart=b;e.currEnd=c;a.manageControls();a.events.onResize&&a.events.onResize(e.maxAllowed,a.mainObj);a.status.animation=a.status.callBackResize=!1;a.play();return a}}),a.initialize()};f.fn.PAGE_Slideshow=function(f,h){this.each(function(){new t(f,h)})}}}})(this);
